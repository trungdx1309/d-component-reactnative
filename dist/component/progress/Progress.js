import _pt from "prop-types";

/* eslint-disable class-methods-use-this */
import React, { Component } from "react";
import { Actions } from "react-native-router-flux";
import { TouchableOpacity, Dimensions, StyleSheet, View, Text, Platform } from "react-native";
import _ from "lodash"; // import Messages from "../../i18n/Messages";

import AppSizes from "../../style/constant/AppSizes";
import AppColors from "../../style/constant/AppColors";
const {
  width,
  height
} = Dimensions.get("window");
const DefaultConfig = {
  maxWidthPercentage: 0.8,
  maxHeightPercentage: 0.8
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
    position: "absolute",
    left: 0,
    top: 0,
    right: 0,
    bottom: 0,
    backgroundColor: "rgba(0, 0, 0, 0.8)",
    justifyContent: "center",
    alignItems: "center"
  },
  dialog: {
    backgroundColor: "#fff",
    width: Math.min(AppSizes.screenWidth, AppSizes.screenHeight) * DefaultConfig.maxWidthPercentage,
    maxHeight: height * DefaultConfig.maxHeightPercentage,
    borderRadius: 5,
    borderWidth: 0
  },
  title: {
    alignSelf: "stretch",
    textAlign: "center",
    margin: AppSizes.paddingSml,
    color: AppColors.textColor
  },
  textContent: {
    padding: AppSizes.paddingMedium,
    color: AppColors.textColor,
    textAlign: "center",
    marginVertical: AppSizes.paddingSml
  },
  divider: {
    backgroundColor: AppColors.primaryColor,
    alignSelf: "stretch"
  },
  button: {
    flex: 1
  },
  buttonText: {
    textAlign: "center",
    padding: AppSizes.paddingSml,
    backgroundColor: "transparent",
    color: AppColors.primaryColor,
    marginVertical: Platform.OS === "ios" ? 0 : AppSizes.paddingXXTiny
  },
  buttonStyle: {
    flex: 1
  },
  textLoading: {
    paddingLeft: AppSizes.paddingMedium,
    paddingTop: AppSizes.padding,
    paddingBottom: AppSizes.padding,
    color: AppColors.textColor,
    fontSize: AppSizes.fontXXMedium,
    textAlign: "center",
    height: "100%",
    justifyContent: "center"
  },
  loadingContainer: {
    // width: AppSizes.paddingMedium * 2,
    // backgroundColor: 'red',
    height: 100,
    backgroundColor: "transparent",
    // flexDirection: 'row',
    padding: AppSizes.paddingXXSml,
    alignItems: "center",
    justifyContent: "center" // borderRadius: AppSizes.paddingTiny,
    // borderWidth: AppSizes.paddingMicro,
    // borderColor: AppColors.grayLight

  },
  lottieView: {
    width: AppSizes.paddingLarge * 5,
    height: AppSizes.paddingLarge * 5
  }
});

class Progress extends Component {
  static propTypes = {
    onSuccess: _pt.func,
    promiseFunction: _pt.oneOfType([_pt.arrayOf(_pt.shape({
      method: _pt.func.isRequired,
      params: _pt.any.isRequired
    })), _pt.shape({
      method: _pt.func.isRequired,
      params: _pt.any.isRequired
    })]).isRequired,
    onError: _pt.func,
    handleError: _pt.func
  };

  static show(promiseFunction, onSuccess, onError, handleError) {
    // if (!_.isFunction(promiseFunction)) {
    //   throw new Error("Progress.show: First param must be a function");
    // }
    Actions.progress({
      promiseFunction,
      onSuccess,
      onError,
      handleError
    });
  }

  constructor(props) {
    super(props);
    this.state = {
      error: undefined
    };
  }

  componentDidMount() {
    this.doTask();
  }

  componentWillUnmount() {
    this.unmounted = true;
  }

  setError(error) {
    if (this.props.handleError && this.props.handleError(error)) {
      this.dismiss();
      return;
    }

    if (error && error.response && error.response.data) {
      this.setState({
        error: error.response.data
      });
      return;
    }

    if (error?.data?.message) {
      this.setState({
        error: error?.data
      });
      return;
    }

    this.setState({
      error
    });
  }

  generatePromiseFunc = proFunc => {
    const {
      method,
      params
    } = proFunc;
    let taskItem;

    if (!_.isArray(params)) {
      taskItem = method(params);
    } else {
      taskItem = method(...params);
    }

    return taskItem;
  };

  cancel() {
    this.dismiss();

    if (this.props.onError) {
      this.props.onError(this.state.error);
    }
  }

  dismiss() {
    // this.abivinLoading.stopAnimated()
    Actions.pop();
  }

  doTask() {
    this.setState({
      error: null
    }, () => {
      const {
        promiseFunction,
        onError,
        onSuccess,
        handleError
      } = this.props; // if (!_.isArray(this.props.params))
      //   task = this.props.promiseFunction(this.props.params);
      // else task = this.props.promiseFunction(...this.props.params);

      let promiseAll;

      const isArrayFunc = _.isArray(promiseFunction);

      if (isArrayFunc) {
        //@ts-ignore
        promiseAll = promiseFunction.map(func => this.generatePromiseFunc(func));
      } else {
        promiseAll = [this.generatePromiseFunc(promiseFunction)];
      }

      const task = Promise.all(promiseAll);
      console.log(task);
      task.then(result => {
        // call server and receive response with known exception
        if (result) {
          // if (
          //   result.request &&
          //   result.data &&
          //   result.data.responseData &&
          //   result.data.responseData.error
          // ) {
          //   this.setError(result.data.responseData.error);
          //   return;
          // }
          // const error = result?.data?.error?.status;
          // if (!_.isEmpty(error)) {
          //   this.setError(result?.data);
          //   return;
          // }
          // Success
          this.dismiss();

          if (onSuccess) {
            onSuccess(isArrayFunc ? result : result?.[0]);
          }
        } else {
          this.setError({// message: Messages.notResponseServer,
          });
        }
      }).catch(error => {
        if (this.unmounted) {
          throw error;
        }

        this.setError(error);
      });
    });
  }

  retry() {
    this.doTask();
  }

  renderLoadingView() {
    return <View style={styles.loadingContainer}>
        <Text style={[styles.textLoading, {
        color: "white"
      }]}>
          #keepcalmNfightcorona
        </Text>
      </View>;
  }

  renderHorizontalDivider() {
    return <View style={[styles.divider, {
      height: 1
    }]} />;
  }

  renderVerticalDivider() {
    return <View style={[styles.divider, {
      width: 1
    }]} />;
  }

  render() {
    const {
      error
    } = this.state;
    return (
      /** Dim background and handle touch outside */
      <View style={styles.container}>
        {!error && this.renderLoadingView()}
        {error && <View style={styles.dialog}>
            {
            /* <Text style={styles.title}>{Messages.error}</Text> */
          }
            <Text style={styles.textContent}>{error.message}</Text>

            {this.renderHorizontalDivider()}
            <View style={{
            flexDirection: "row-reverse",
            alignItems: "center"
          }}>
              <TouchableOpacity style={styles.buttonStyle} onPress={() => this.retry()}>
                {
                /* <Text style={styles.buttonText}>{Messages.retry}</Text> */
              }
              </TouchableOpacity>
              {this.renderVerticalDivider()}
              <TouchableOpacity style={styles.buttonStyle} onPress={() => this.cancel()}>
                {
                /* <Text style={styles.buttonText}>{Messages.cancel}</Text> */
              }
              </TouchableOpacity>
            </View>
          </View>}
      </View>
    );
  }

}

export default Progress;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnQvcHJvZ3Jlc3MvUHJvZ3Jlc3MudHN4Il0sIm5hbWVzIjpbIlJlYWN0IiwiQ29tcG9uZW50IiwiQWN0aW9ucyIsIlRvdWNoYWJsZU9wYWNpdHkiLCJEaW1lbnNpb25zIiwiU3R5bGVTaGVldCIsIlZpZXciLCJUZXh0IiwiUGxhdGZvcm0iLCJfIiwiQXBwU2l6ZXMiLCJBcHBDb2xvcnMiLCJ3aWR0aCIsImhlaWdodCIsImdldCIsIkRlZmF1bHRDb25maWciLCJtYXhXaWR0aFBlcmNlbnRhZ2UiLCJtYXhIZWlnaHRQZXJjZW50YWdlIiwic3R5bGVzIiwiY3JlYXRlIiwiY29udGFpbmVyIiwiZmxleCIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsInJpZ2h0IiwiYm90dG9tIiwiYmFja2dyb3VuZENvbG9yIiwianVzdGlmeUNvbnRlbnQiLCJhbGlnbkl0ZW1zIiwiZGlhbG9nIiwiTWF0aCIsIm1pbiIsInNjcmVlbldpZHRoIiwic2NyZWVuSGVpZ2h0IiwibWF4SGVpZ2h0IiwiYm9yZGVyUmFkaXVzIiwiYm9yZGVyV2lkdGgiLCJ0aXRsZSIsImFsaWduU2VsZiIsInRleHRBbGlnbiIsIm1hcmdpbiIsInBhZGRpbmdTbWwiLCJjb2xvciIsInRleHRDb2xvciIsInRleHRDb250ZW50IiwicGFkZGluZyIsInBhZGRpbmdNZWRpdW0iLCJtYXJnaW5WZXJ0aWNhbCIsImRpdmlkZXIiLCJwcmltYXJ5Q29sb3IiLCJidXR0b24iLCJidXR0b25UZXh0IiwiT1MiLCJwYWRkaW5nWFhUaW55IiwiYnV0dG9uU3R5bGUiLCJ0ZXh0TG9hZGluZyIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iLCJmb250U2l6ZSIsImZvbnRYWE1lZGl1bSIsImxvYWRpbmdDb250YWluZXIiLCJwYWRkaW5nWFhTbWwiLCJsb3R0aWVWaWV3IiwicGFkZGluZ0xhcmdlIiwiUHJvZ3Jlc3MiLCJvblN1Y2Nlc3MiLCJwcm9taXNlRnVuY3Rpb24iLCJtZXRob2QiLCJwYXJhbXMiLCJvbkVycm9yIiwiaGFuZGxlRXJyb3IiLCJzaG93IiwicHJvZ3Jlc3MiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic3RhdGUiLCJlcnJvciIsInVuZGVmaW5lZCIsImNvbXBvbmVudERpZE1vdW50IiwiZG9UYXNrIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJ1bm1vdW50ZWQiLCJzZXRFcnJvciIsImRpc21pc3MiLCJyZXNwb25zZSIsImRhdGEiLCJzZXRTdGF0ZSIsIm1lc3NhZ2UiLCJnZW5lcmF0ZVByb21pc2VGdW5jIiwicHJvRnVuYyIsInRhc2tJdGVtIiwiaXNBcnJheSIsImNhbmNlbCIsInBvcCIsInByb21pc2VBbGwiLCJpc0FycmF5RnVuYyIsIm1hcCIsImZ1bmMiLCJ0YXNrIiwiUHJvbWlzZSIsImFsbCIsImNvbnNvbGUiLCJsb2ciLCJ0aGVuIiwicmVzdWx0IiwiY2F0Y2giLCJyZXRyeSIsInJlbmRlckxvYWRpbmdWaWV3IiwicmVuZGVySG9yaXpvbnRhbERpdmlkZXIiLCJyZW5kZXJWZXJ0aWNhbERpdmlkZXIiLCJyZW5kZXIiLCJmbGV4RGlyZWN0aW9uIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0EsT0FBT0EsS0FBUCxJQUFnQkMsU0FBaEIsUUFBaUMsT0FBakM7QUFDQSxTQUFTQyxPQUFULFFBQWlDLDBCQUFqQztBQUNBLFNBQ0VDLGdCQURGLEVBRUVDLFVBRkYsRUFHRUMsVUFIRixFQUlFQyxJQUpGLEVBS0VDLElBTEYsRUFPRUMsUUFQRixRQVFPLGNBUlA7QUFTQSxPQUFPQyxDQUFQLE1BQWMsUUFBZCxDLENBQ0E7O0FBQ0EsT0FBT0MsUUFBUDtBQUNBLE9BQU9DLFNBQVA7QUFFQSxNQUFNO0FBQUVDLEVBQUFBLEtBQUY7QUFBU0MsRUFBQUE7QUFBVCxJQUFvQlQsVUFBVSxDQUFDVSxHQUFYLENBQWUsUUFBZixDQUExQjtBQUVBLE1BQU1DLGFBQWEsR0FBRztBQUNwQkMsRUFBQUEsa0JBQWtCLEVBQUUsR0FEQTtBQUVwQkMsRUFBQUEsbUJBQW1CLEVBQUU7QUFGRCxDQUF0QjtBQUtBLE1BQU1DLE1BQU0sR0FBR2IsVUFBVSxDQUFDYyxNQUFYLENBQWtCO0FBQy9CQyxFQUFBQSxTQUFTLEVBQUU7QUFDVEMsSUFBQUEsSUFBSSxFQUFFLENBREc7QUFFVEMsSUFBQUEsUUFBUSxFQUFFLFVBRkQ7QUFHVEMsSUFBQUEsSUFBSSxFQUFFLENBSEc7QUFJVEMsSUFBQUEsR0FBRyxFQUFFLENBSkk7QUFLVEMsSUFBQUEsS0FBSyxFQUFFLENBTEU7QUFNVEMsSUFBQUEsTUFBTSxFQUFFLENBTkM7QUFPVEMsSUFBQUEsZUFBZSxFQUFFLG9CQVBSO0FBUVRDLElBQUFBLGNBQWMsRUFBRSxRQVJQO0FBU1RDLElBQUFBLFVBQVUsRUFBRTtBQVRILEdBRG9CO0FBWS9CQyxFQUFBQSxNQUFNLEVBQUU7QUFDTkgsSUFBQUEsZUFBZSxFQUFFLE1BRFg7QUFFTmYsSUFBQUEsS0FBSyxFQUNIbUIsSUFBSSxDQUFDQyxHQUFMLENBQVN0QixRQUFRLENBQUN1QixXQUFsQixFQUErQnZCLFFBQVEsQ0FBQ3dCLFlBQXhDLElBQ0FuQixhQUFhLENBQUNDLGtCQUpWO0FBS05tQixJQUFBQSxTQUFTLEVBQUV0QixNQUFNLEdBQUdFLGFBQWEsQ0FBQ0UsbUJBTDVCO0FBTU5tQixJQUFBQSxZQUFZLEVBQUUsQ0FOUjtBQU9OQyxJQUFBQSxXQUFXLEVBQUU7QUFQUCxHQVp1QjtBQXFCL0JDLEVBQUFBLEtBQUssRUFBRTtBQUNMQyxJQUFBQSxTQUFTLEVBQUUsU0FETjtBQUVMQyxJQUFBQSxTQUFTLEVBQUUsUUFGTjtBQUdMQyxJQUFBQSxNQUFNLEVBQUUvQixRQUFRLENBQUNnQyxVQUhaO0FBSUxDLElBQUFBLEtBQUssRUFBRWhDLFNBQVMsQ0FBQ2lDO0FBSlosR0FyQndCO0FBMkIvQkMsRUFBQUEsV0FBVyxFQUFFO0FBQ1hDLElBQUFBLE9BQU8sRUFBRXBDLFFBQVEsQ0FBQ3FDLGFBRFA7QUFFWEosSUFBQUEsS0FBSyxFQUFFaEMsU0FBUyxDQUFDaUMsU0FGTjtBQUdYSixJQUFBQSxTQUFTLEVBQUUsUUFIQTtBQUlYUSxJQUFBQSxjQUFjLEVBQUV0QyxRQUFRLENBQUNnQztBQUpkLEdBM0JrQjtBQWlDL0JPLEVBQUFBLE9BQU8sRUFBRTtBQUNQdEIsSUFBQUEsZUFBZSxFQUFFaEIsU0FBUyxDQUFDdUMsWUFEcEI7QUFFUFgsSUFBQUEsU0FBUyxFQUFFO0FBRkosR0FqQ3NCO0FBcUMvQlksRUFBQUEsTUFBTSxFQUFFO0FBQ045QixJQUFBQSxJQUFJLEVBQUU7QUFEQSxHQXJDdUI7QUF3Qy9CK0IsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZaLElBQUFBLFNBQVMsRUFBRSxRQUREO0FBRVZNLElBQUFBLE9BQU8sRUFBRXBDLFFBQVEsQ0FBQ2dDLFVBRlI7QUFHVmYsSUFBQUEsZUFBZSxFQUFFLGFBSFA7QUFJVmdCLElBQUFBLEtBQUssRUFBRWhDLFNBQVMsQ0FBQ3VDLFlBSlA7QUFLVkYsSUFBQUEsY0FBYyxFQUFFeEMsUUFBUSxDQUFDNkMsRUFBVCxLQUFnQixLQUFoQixHQUF3QixDQUF4QixHQUE0QjNDLFFBQVEsQ0FBQzRDO0FBTDNDLEdBeENtQjtBQStDL0JDLEVBQUFBLFdBQVcsRUFBRTtBQUNYbEMsSUFBQUEsSUFBSSxFQUFFO0FBREssR0EvQ2tCO0FBa0QvQm1DLEVBQUFBLFdBQVcsRUFBRTtBQUNYQyxJQUFBQSxXQUFXLEVBQUUvQyxRQUFRLENBQUNxQyxhQURYO0FBRVhXLElBQUFBLFVBQVUsRUFBRWhELFFBQVEsQ0FBQ29DLE9BRlY7QUFHWGEsSUFBQUEsYUFBYSxFQUFFakQsUUFBUSxDQUFDb0MsT0FIYjtBQUlYSCxJQUFBQSxLQUFLLEVBQUVoQyxTQUFTLENBQUNpQyxTQUpOO0FBS1hnQixJQUFBQSxRQUFRLEVBQUVsRCxRQUFRLENBQUNtRCxZQUxSO0FBTVhyQixJQUFBQSxTQUFTLEVBQUUsUUFOQTtBQU9YM0IsSUFBQUEsTUFBTSxFQUFFLE1BUEc7QUFRWGUsSUFBQUEsY0FBYyxFQUFFO0FBUkwsR0FsRGtCO0FBNEQvQmtDLEVBQUFBLGdCQUFnQixFQUFFO0FBQ2hCO0FBQ0E7QUFDQWpELElBQUFBLE1BQU0sRUFBRSxHQUhRO0FBSWhCYyxJQUFBQSxlQUFlLEVBQUUsYUFKRDtBQUtoQjtBQUNBbUIsSUFBQUEsT0FBTyxFQUFFcEMsUUFBUSxDQUFDcUQsWUFORjtBQU9oQmxDLElBQUFBLFVBQVUsRUFBRSxRQVBJO0FBUWhCRCxJQUFBQSxjQUFjLEVBQUUsUUFSQSxDQVNoQjtBQUNBO0FBQ0E7O0FBWGdCLEdBNURhO0FBeUUvQm9DLEVBQUFBLFVBQVUsRUFBRTtBQUNWcEQsSUFBQUEsS0FBSyxFQUFFRixRQUFRLENBQUN1RCxZQUFULEdBQXdCLENBRHJCO0FBRVZwRCxJQUFBQSxNQUFNLEVBQUVILFFBQVEsQ0FBQ3VELFlBQVQsR0FBd0I7QUFGdEI7QUF6RW1CLENBQWxCLENBQWY7O0FBc0dBLE1BQU1DLFFBQU4sU0FBdUJqRSxTQUF2QixDQUFpRTtBQUFBO0FBVC9Ea0UsSUFBQUEsU0FTK0Q7QUFSL0RDLElBQUFBLGVBUStEO0FBdEIvREMsTUFBQUEsTUFzQitEO0FBckIvREMsTUFBQUEsTUFxQitEO0FBQUE7QUF0Qi9ERCxNQUFBQSxNQXNCK0Q7QUFyQi9EQyxNQUFBQSxNQXFCK0Q7QUFBQTtBQVAvREMsSUFBQUEsT0FPK0Q7QUFOL0RDLElBQUFBLFdBTStEO0FBQUE7O0FBQ3BELFNBQUpDLElBQUksQ0FDVEwsZUFEUyxFQUVURCxTQUZTLEVBR1RJLE9BSFMsRUFJVEMsV0FKUyxFQUtUO0FBQ0E7QUFDQTtBQUNBO0FBQ0F0RSxJQUFBQSxPQUFPLENBQUN3RSxRQUFSLENBQWlCO0FBQ2ZOLE1BQUFBLGVBRGU7QUFFZkQsTUFBQUEsU0FGZTtBQUdmSSxNQUFBQSxPQUhlO0FBSWZDLE1BQUFBO0FBSmUsS0FBakI7QUFNRDs7QUFJREcsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWE7QUFDdEIsVUFBTUEsS0FBTjtBQUNBLFNBQUtDLEtBQUwsR0FBYTtBQUNYQyxNQUFBQSxLQUFLLEVBQUVDO0FBREksS0FBYjtBQUdEOztBQUVEQyxFQUFBQSxpQkFBaUIsR0FBRztBQUNsQixTQUFLQyxNQUFMO0FBQ0Q7O0FBRURDLEVBQUFBLG9CQUFvQixHQUFHO0FBQ3JCLFNBQUtDLFNBQUwsR0FBaUIsSUFBakI7QUFDRDs7QUFFREMsRUFBQUEsUUFBUSxDQUFDTixLQUFELEVBQWE7QUFDbkIsUUFBSSxLQUFLRixLQUFMLENBQVdKLFdBQVgsSUFBMEIsS0FBS0ksS0FBTCxDQUFXSixXQUFYLENBQXVCTSxLQUF2QixDQUE5QixFQUE2RDtBQUMzRCxXQUFLTyxPQUFMO0FBQ0E7QUFDRDs7QUFDRCxRQUFJUCxLQUFLLElBQUlBLEtBQUssQ0FBQ1EsUUFBZixJQUEyQlIsS0FBSyxDQUFDUSxRQUFOLENBQWVDLElBQTlDLEVBQW9EO0FBQ2xELFdBQUtDLFFBQUwsQ0FBYztBQUFFVixRQUFBQSxLQUFLLEVBQUVBLEtBQUssQ0FBQ1EsUUFBTixDQUFlQztBQUF4QixPQUFkO0FBQ0E7QUFDRDs7QUFDRCxRQUFJVCxLQUFLLEVBQUVTLElBQVAsRUFBYUUsT0FBakIsRUFBMEI7QUFDeEIsV0FBS0QsUUFBTCxDQUFjO0FBQUVWLFFBQUFBLEtBQUssRUFBRUEsS0FBSyxFQUFFUztBQUFoQixPQUFkO0FBQ0E7QUFDRDs7QUFDRCxTQUFLQyxRQUFMLENBQWM7QUFBRVYsTUFBQUE7QUFBRixLQUFkO0FBQ0Q7O0FBRURZLEVBQUFBLG1CQUFtQixHQUFJQyxPQUFELElBQXFDO0FBQ3pELFVBQU07QUFBRXRCLE1BQUFBLE1BQUY7QUFBVUMsTUFBQUE7QUFBVixRQUFxQnFCLE9BQTNCO0FBQ0EsUUFBSUMsUUFBSjs7QUFDQSxRQUFJLENBQUNuRixDQUFDLENBQUNvRixPQUFGLENBQVV2QixNQUFWLENBQUwsRUFBd0I7QUFDdEJzQixNQUFBQSxRQUFRLEdBQUd2QixNQUFNLENBQUNDLE1BQUQsQ0FBakI7QUFDRCxLQUZELE1BRU87QUFDTHNCLE1BQUFBLFFBQVEsR0FBR3ZCLE1BQU0sQ0FBQyxHQUFHQyxNQUFKLENBQWpCO0FBQ0Q7O0FBQ0QsV0FBT3NCLFFBQVA7QUFDRCxHQVRrQjs7QUFXbkJFLEVBQUFBLE1BQU0sR0FBRztBQUNQLFNBQUtULE9BQUw7O0FBQ0EsUUFBSSxLQUFLVCxLQUFMLENBQVdMLE9BQWYsRUFBd0I7QUFDdEIsV0FBS0ssS0FBTCxDQUFXTCxPQUFYLENBQW1CLEtBQUtNLEtBQUwsQ0FBV0MsS0FBOUI7QUFDRDtBQUNGOztBQUVETyxFQUFBQSxPQUFPLEdBQUc7QUFDUjtBQUNBbkYsSUFBQUEsT0FBTyxDQUFDNkYsR0FBUjtBQUNEOztBQUVEZCxFQUFBQSxNQUFNLEdBQUc7QUFDUCxTQUFLTyxRQUFMLENBQWM7QUFBRVYsTUFBQUEsS0FBSyxFQUFFO0FBQVQsS0FBZCxFQUErQixNQUFNO0FBQ25DLFlBQU07QUFBRVYsUUFBQUEsZUFBRjtBQUFtQkcsUUFBQUEsT0FBbkI7QUFBNEJKLFFBQUFBLFNBQTVCO0FBQXVDSyxRQUFBQTtBQUF2QyxVQUF1RCxLQUFLSSxLQUFsRSxDQURtQyxDQUVuQztBQUNBO0FBQ0E7O0FBQ0EsVUFBSW9CLFVBQUo7O0FBQ0EsWUFBTUMsV0FBVyxHQUFHeEYsQ0FBQyxDQUFDb0YsT0FBRixDQUFVekIsZUFBVixDQUFwQjs7QUFDQSxVQUFJNkIsV0FBSixFQUFpQjtBQUNmO0FBQ0FELFFBQUFBLFVBQVUsR0FBRzVCLGVBQWUsQ0FBQzhCLEdBQWhCLENBQXFCQyxJQUFELElBQy9CLEtBQUtULG1CQUFMLENBQXlCUyxJQUF6QixDQURXLENBQWI7QUFHRCxPQUxELE1BS087QUFDTEgsUUFBQUEsVUFBVSxHQUFHLENBQUMsS0FBS04sbUJBQUwsQ0FBeUJ0QixlQUF6QixDQUFELENBQWI7QUFDRDs7QUFDRCxZQUFNZ0MsSUFBSSxHQUFHQyxPQUFPLENBQUNDLEdBQVIsQ0FBWU4sVUFBWixDQUFiO0FBQ0FPLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSixJQUFaO0FBQ0FBLE1BQUFBLElBQUksQ0FDREssSUFESCxDQUNTQyxNQUFELElBQWlCO0FBQ3JCO0FBQ0EsWUFBSUEsTUFBSixFQUFZO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBS3JCLE9BQUw7O0FBQ0EsY0FBSWxCLFNBQUosRUFBZTtBQUNiQSxZQUFBQSxTQUFTLENBQUM4QixXQUFXLEdBQUdTLE1BQUgsR0FBWUEsTUFBTSxHQUFHLENBQUgsQ0FBOUIsQ0FBVDtBQUNEO0FBQ0YsU0F0QkQsTUFzQk87QUFDTCxlQUFLdEIsUUFBTCxDQUFjLENBQ1o7QUFEWSxXQUFkO0FBR0Q7QUFDRixPQTlCSCxFQStCR3VCLEtBL0JILENBK0JVN0IsS0FBRCxJQUFnQjtBQUNyQixZQUFJLEtBQUtLLFNBQVQsRUFBb0I7QUFDbEIsZ0JBQU1MLEtBQU47QUFDRDs7QUFDRCxhQUFLTSxRQUFMLENBQWNOLEtBQWQ7QUFDRCxPQXBDSDtBQXFDRCxLQXRERDtBQXVERDs7QUFFRDhCLEVBQUFBLEtBQUssR0FBRztBQUNOLFNBQUszQixNQUFMO0FBQ0Q7O0FBRUQ0QixFQUFBQSxpQkFBaUIsR0FBRztBQUNsQixXQUNFLENBQUMsSUFBRCxDQUFNLE1BQU0sQ0FBQzNGLE1BQU0sQ0FBQzRDLGdCQUFSLENBQVo7QUFDTixRQUFRLENBQUMsSUFBRCxDQUFNLE1BQU0sQ0FBQyxDQUFDNUMsTUFBTSxDQUFDc0MsV0FBUixFQUFxQjtBQUFFYixRQUFBQSxLQUFLLEVBQUU7QUFBVCxPQUFyQixDQUFELENBQVo7QUFDUjtBQUNBLFFBQVEsRUFBRSxJQUFGO0FBQ1IsTUFBTSxFQUFFLElBQUYsQ0FMRjtBQU9EOztBQUVEbUUsRUFBQUEsdUJBQXVCLEdBQUc7QUFDeEIsV0FBTyxDQUFDLElBQUQsQ0FBTSxNQUFNLENBQUMsQ0FBQzVGLE1BQU0sQ0FBQytCLE9BQVIsRUFBaUI7QUFBRXBDLE1BQUFBLE1BQU0sRUFBRTtBQUFWLEtBQWpCLENBQUQsQ0FBWixHQUFQO0FBQ0Q7O0FBRURrRyxFQUFBQSxxQkFBcUIsR0FBRztBQUN0QixXQUFPLENBQUMsSUFBRCxDQUFNLE1BQU0sQ0FBQyxDQUFDN0YsTUFBTSxDQUFDK0IsT0FBUixFQUFpQjtBQUFFckMsTUFBQUEsS0FBSyxFQUFFO0FBQVQsS0FBakIsQ0FBRCxDQUFaLEdBQVA7QUFDRDs7QUFFRG9HLEVBQUFBLE1BQU0sR0FBRztBQUNQLFVBQU07QUFBRWxDLE1BQUFBO0FBQUYsUUFBWSxLQUFLRCxLQUF2QjtBQUNBO0FBQ0U7QUFDQSxPQUFDLElBQUQsQ0FBTSxNQUFNLENBQUMzRCxNQUFNLENBQUNFLFNBQVIsQ0FBWjtBQUNOLFFBQVEsQ0FBQyxDQUFDMEQsS0FBRCxJQUFVLEtBQUsrQixpQkFBTCxFQUFYO0FBQ1IsUUFBUSxDQUFDL0IsS0FBSyxJQUNKLENBQUMsSUFBRCxDQUFNLE1BQU0sQ0FBQzVELE1BQU0sQ0FBQ1ksTUFBUixDQUFaO0FBQ1YsWUFBWTtBQUFDO0FBQUQ7QUFDWixZQUFZLENBQUMsSUFBRCxDQUFNLE1BQU0sQ0FBQ1osTUFBTSxDQUFDMkIsV0FBUixDQUFaLENBQWlDLENBQUNpQyxLQUFLLENBQUNXLE9BQVAsQ0FBZSxFQUFFLElBQUY7QUFDNUQ7QUFDQSxZQUFZLENBQUMsS0FBS3FCLHVCQUFMLEVBQUQ7QUFDWixZQUFZLENBQUMsSUFBRCxDQUNFLE1BQU0sQ0FBQztBQUFFRyxZQUFBQSxhQUFhLEVBQUUsYUFBakI7QUFBZ0NwRixZQUFBQSxVQUFVLEVBQUU7QUFBNUMsV0FBRCxDQURSO0FBR1osY0FBYyxDQUFDLGdCQUFELENBQ0UsTUFBTSxDQUFDWCxNQUFNLENBQUNxQyxXQUFSLENBRFIsQ0FFRSxRQUFRLENBQUMsTUFBTSxLQUFLcUQsS0FBTCxFQUFQLENBRlY7QUFJZCxnQkFBZ0I7QUFBQztBQUFEO0FBQ2hCLGNBQWMsRUFBRSxnQkFBRjtBQUNkLGNBQWMsQ0FBQyxLQUFLRyxxQkFBTCxFQUFEO0FBQ2QsY0FBYyxDQUFDLGdCQUFELENBQ0UsTUFBTSxDQUFDN0YsTUFBTSxDQUFDcUMsV0FBUixDQURSLENBRUUsUUFBUSxDQUFDLE1BQU0sS0FBS3VDLE1BQUwsRUFBUCxDQUZWO0FBSWQsZ0JBQWdCO0FBQUM7QUFBRDtBQUNoQixjQUFjLEVBQUUsZ0JBQUY7QUFDZCxZQUFZLEVBQUUsSUFBRjtBQUNaLFVBQVUsRUFBRSxJQUFGLENBdkJGO0FBeUJSLE1BQU0sRUFBRSxJQUFGO0FBN0JGO0FBK0JEOztBQTNMOEQ7O0FBNkxqRSxlQUFlNUIsUUFBZiIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMgKi9cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IEFjdGlvbnMsIE92ZXJsYXkgfSBmcm9tIFwicmVhY3QtbmF0aXZlLXJvdXRlci1mbHV4XCI7XG5pbXBvcnQge1xuICBUb3VjaGFibGVPcGFjaXR5LFxuICBEaW1lbnNpb25zLFxuICBTdHlsZVNoZWV0LFxuICBWaWV3LFxuICBUZXh0LFxuICBBY3Rpdml0eUluZGljYXRvcixcbiAgUGxhdGZvcm0sXG59IGZyb20gXCJyZWFjdC1uYXRpdmVcIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcbi8vIGltcG9ydCBNZXNzYWdlcyBmcm9tIFwiLi4vLi4vaTE4bi9NZXNzYWdlc1wiO1xuaW1wb3J0IEFwcFNpemVzIGZyb20gXCIuLi8uLi9zdHlsZS9jb25zdGFudC9BcHBTaXplc1wiO1xuaW1wb3J0IEFwcENvbG9ycyBmcm9tIFwiLi4vLi4vc3R5bGUvY29uc3RhbnQvQXBwQ29sb3JzXCI7XG5cbmNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gRGltZW5zaW9ucy5nZXQoXCJ3aW5kb3dcIik7XG5cbmNvbnN0IERlZmF1bHRDb25maWcgPSB7XG4gIG1heFdpZHRoUGVyY2VudGFnZTogMC44LFxuICBtYXhIZWlnaHRQZXJjZW50YWdlOiAwLjgsXG59O1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGNvbnRhaW5lcjoge1xuICAgIGZsZXg6IDEsXG4gICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICBsZWZ0OiAwLFxuICAgIHRvcDogMCxcbiAgICByaWdodDogMCxcbiAgICBib3R0b206IDAsXG4gICAgYmFja2dyb3VuZENvbG9yOiBcInJnYmEoMCwgMCwgMCwgMC44KVwiLFxuICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiLFxuICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gIH0sXG4gIGRpYWxvZzoge1xuICAgIGJhY2tncm91bmRDb2xvcjogXCIjZmZmXCIsXG4gICAgd2lkdGg6XG4gICAgICBNYXRoLm1pbihBcHBTaXplcy5zY3JlZW5XaWR0aCwgQXBwU2l6ZXMuc2NyZWVuSGVpZ2h0KSAqXG4gICAgICBEZWZhdWx0Q29uZmlnLm1heFdpZHRoUGVyY2VudGFnZSxcbiAgICBtYXhIZWlnaHQ6IGhlaWdodCAqIERlZmF1bHRDb25maWcubWF4SGVpZ2h0UGVyY2VudGFnZSxcbiAgICBib3JkZXJSYWRpdXM6IDUsXG4gICAgYm9yZGVyV2lkdGg6IDAsXG4gIH0sXG4gIHRpdGxlOiB7XG4gICAgYWxpZ25TZWxmOiBcInN0cmV0Y2hcIixcbiAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgbWFyZ2luOiBBcHBTaXplcy5wYWRkaW5nU21sLFxuICAgIGNvbG9yOiBBcHBDb2xvcnMudGV4dENvbG9yLFxuICB9LFxuICB0ZXh0Q29udGVudDoge1xuICAgIHBhZGRpbmc6IEFwcFNpemVzLnBhZGRpbmdNZWRpdW0sXG4gICAgY29sb3I6IEFwcENvbG9ycy50ZXh0Q29sb3IsXG4gICAgdGV4dEFsaWduOiBcImNlbnRlclwiLFxuICAgIG1hcmdpblZlcnRpY2FsOiBBcHBTaXplcy5wYWRkaW5nU21sLFxuICB9LFxuICBkaXZpZGVyOiB7XG4gICAgYmFja2dyb3VuZENvbG9yOiBBcHBDb2xvcnMucHJpbWFyeUNvbG9yLFxuICAgIGFsaWduU2VsZjogXCJzdHJldGNoXCIsXG4gIH0sXG4gIGJ1dHRvbjoge1xuICAgIGZsZXg6IDEsXG4gIH0sXG4gIGJ1dHRvblRleHQ6IHtcbiAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgcGFkZGluZzogQXBwU2l6ZXMucGFkZGluZ1NtbCxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICBjb2xvcjogQXBwQ29sb3JzLnByaW1hcnlDb2xvcixcbiAgICBtYXJnaW5WZXJ0aWNhbDogUGxhdGZvcm0uT1MgPT09IFwiaW9zXCIgPyAwIDogQXBwU2l6ZXMucGFkZGluZ1hYVGlueSxcbiAgfSxcbiAgYnV0dG9uU3R5bGU6IHtcbiAgICBmbGV4OiAxLFxuICB9LFxuICB0ZXh0TG9hZGluZzoge1xuICAgIHBhZGRpbmdMZWZ0OiBBcHBTaXplcy5wYWRkaW5nTWVkaXVtLFxuICAgIHBhZGRpbmdUb3A6IEFwcFNpemVzLnBhZGRpbmcsXG4gICAgcGFkZGluZ0JvdHRvbTogQXBwU2l6ZXMucGFkZGluZyxcbiAgICBjb2xvcjogQXBwQ29sb3JzLnRleHRDb2xvcixcbiAgICBmb250U2l6ZTogQXBwU2l6ZXMuZm9udFhYTWVkaXVtLFxuICAgIHRleHRBbGlnbjogXCJjZW50ZXJcIixcbiAgICBoZWlnaHQ6IFwiMTAwJVwiLFxuICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiLFxuICB9LFxuICBsb2FkaW5nQ29udGFpbmVyOiB7XG4gICAgLy8gd2lkdGg6IEFwcFNpemVzLnBhZGRpbmdNZWRpdW0gKiAyLFxuICAgIC8vIGJhY2tncm91bmRDb2xvcjogJ3JlZCcsXG4gICAgaGVpZ2h0OiAxMDAsXG4gICAgYmFja2dyb3VuZENvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgLy8gZmxleERpcmVjdGlvbjogJ3JvdycsXG4gICAgcGFkZGluZzogQXBwU2l6ZXMucGFkZGluZ1hYU21sLFxuICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIsXG4gICAgLy8gYm9yZGVyUmFkaXVzOiBBcHBTaXplcy5wYWRkaW5nVGlueSxcbiAgICAvLyBib3JkZXJXaWR0aDogQXBwU2l6ZXMucGFkZGluZ01pY3JvLFxuICAgIC8vIGJvcmRlckNvbG9yOiBBcHBDb2xvcnMuZ3JheUxpZ2h0XG4gIH0sXG4gIGxvdHRpZVZpZXc6IHtcbiAgICB3aWR0aDogQXBwU2l6ZXMucGFkZGluZ0xhcmdlICogNSxcbiAgICBoZWlnaHQ6IEFwcFNpemVzLnBhZGRpbmdMYXJnZSAqIDUsXG4gIH0sXG59KTtcblxuZXhwb3J0IGludGVyZmFjZSBJUHJvZ3Jlc3NGdW5jdGlvblByb3BzIHtcbiAgbWV0aG9kOiAocHJvcHM/OiBhbnksIHBhZ2luZz86IGFueSwgaW5kZXg/OiBhbnkpID0+IGFueTtcbiAgcGFyYW1zOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJlc3BvbnNlQVBJIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICBkYXRhPzogeyBkYXRhPzogYW55OyBwYWdpbmF0aW9uPzogYW55OyBba2V5OiBzdHJpbmddOiBhbnkgfTtcbiAgZXJyb3I/OiBhbnk7XG4gIG1lc3NhZ2U/OiBhbnk7XG4gIHN0YXR1cz86IGFueTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUHJvZ3Jlc3NQcm9wcyB7XG4gIG9uU3VjY2Vzcz86IChyZXM/OiBBcnJheTxJUmVzcG9uc2VBUEk+IHwgSVJlc3BvbnNlQVBJKSA9PiBhbnk7XG4gIHByb21pc2VGdW5jdGlvbjogQXJyYXk8SVByb2dyZXNzRnVuY3Rpb25Qcm9wcz4gfCBJUHJvZ3Jlc3NGdW5jdGlvblByb3BzO1xuICBvbkVycm9yPzogKHByb3BzPzogYW55KSA9PiBhbnk7XG4gIGhhbmRsZUVycm9yPzogKHByb3BzPzogYW55KSA9PiBhbnk7XG59XG5leHBvcnQgaW50ZXJmYWNlIElQcm9ncmVzc1N0YXRlIHtcbiAgZXJyb3I/OiBhbnk7XG59XG5cbmNsYXNzIFByb2dyZXNzIGV4dGVuZHMgQ29tcG9uZW50PElQcm9ncmVzc1Byb3BzLCBJUHJvZ3Jlc3NTdGF0ZT4ge1xuICBzdGF0aWMgc2hvdyhcbiAgICBwcm9taXNlRnVuY3Rpb246IElQcm9ncmVzc1Byb3BzW1wicHJvbWlzZUZ1bmN0aW9uXCJdLFxuICAgIG9uU3VjY2VzczogSVByb2dyZXNzUHJvcHNbXCJvblN1Y2Nlc3NcIl0sXG4gICAgb25FcnJvcj86IElQcm9ncmVzc1Byb3BzW1wib25FcnJvclwiXSxcbiAgICBoYW5kbGVFcnJvcj86IElQcm9ncmVzc1Byb3BzW1wiaGFuZGxlRXJyb3JcIl1cbiAgKSB7XG4gICAgLy8gaWYgKCFfLmlzRnVuY3Rpb24ocHJvbWlzZUZ1bmN0aW9uKSkge1xuICAgIC8vICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvZ3Jlc3Muc2hvdzogRmlyc3QgcGFyYW0gbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO1xuICAgIC8vIH1cbiAgICBBY3Rpb25zLnByb2dyZXNzKHtcbiAgICAgIHByb21pc2VGdW5jdGlvbixcbiAgICAgIG9uU3VjY2VzcyxcbiAgICAgIG9uRXJyb3IsXG4gICAgICBoYW5kbGVFcnJvcixcbiAgICB9KTtcbiAgfVxuXG4gIHVubW91bnRlZDogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBhbnkpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGVycm9yOiB1bmRlZmluZWQsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuZG9UYXNrKCk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnVubW91bnRlZCA9IHRydWU7XG4gIH1cblxuICBzZXRFcnJvcihlcnJvcjogYW55KSB7XG4gICAgaWYgKHRoaXMucHJvcHMuaGFuZGxlRXJyb3IgJiYgdGhpcy5wcm9wcy5oYW5kbGVFcnJvcihlcnJvcikpIHtcbiAgICAgIHRoaXMuZGlzbWlzcygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgJiYgZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2UuZGF0YSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yOiBlcnJvci5yZXNwb25zZS5kYXRhIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXJyb3I/LmRhdGE/Lm1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvcjogZXJyb3I/LmRhdGEgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvciB9KTtcbiAgfVxuXG4gIGdlbmVyYXRlUHJvbWlzZUZ1bmMgPSAocHJvRnVuYzogSVByb2dyZXNzRnVuY3Rpb25Qcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgbWV0aG9kLCBwYXJhbXMgfSA9IHByb0Z1bmM7XG4gICAgbGV0IHRhc2tJdGVtOiBhbnk7XG4gICAgaWYgKCFfLmlzQXJyYXkocGFyYW1zKSkge1xuICAgICAgdGFza0l0ZW0gPSBtZXRob2QocGFyYW1zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFza0l0ZW0gPSBtZXRob2QoLi4ucGFyYW1zKTtcbiAgICB9XG4gICAgcmV0dXJuIHRhc2tJdGVtO1xuICB9O1xuXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLmRpc21pc3MoKTtcbiAgICBpZiAodGhpcy5wcm9wcy5vbkVycm9yKSB7XG4gICAgICB0aGlzLnByb3BzLm9uRXJyb3IodGhpcy5zdGF0ZS5lcnJvcik7XG4gICAgfVxuICB9XG5cbiAgZGlzbWlzcygpIHtcbiAgICAvLyB0aGlzLmFiaXZpbkxvYWRpbmcuc3RvcEFuaW1hdGVkKClcbiAgICBBY3Rpb25zLnBvcCgpO1xuICB9XG5cbiAgZG9UYXNrKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvcjogbnVsbCB9LCAoKSA9PiB7XG4gICAgICBjb25zdCB7IHByb21pc2VGdW5jdGlvbiwgb25FcnJvciwgb25TdWNjZXNzLCBoYW5kbGVFcnJvciB9ID0gdGhpcy5wcm9wcztcbiAgICAgIC8vIGlmICghXy5pc0FycmF5KHRoaXMucHJvcHMucGFyYW1zKSlcbiAgICAgIC8vICAgdGFzayA9IHRoaXMucHJvcHMucHJvbWlzZUZ1bmN0aW9uKHRoaXMucHJvcHMucGFyYW1zKTtcbiAgICAgIC8vIGVsc2UgdGFzayA9IHRoaXMucHJvcHMucHJvbWlzZUZ1bmN0aW9uKC4uLnRoaXMucHJvcHMucGFyYW1zKTtcbiAgICAgIGxldCBwcm9taXNlQWxsO1xuICAgICAgY29uc3QgaXNBcnJheUZ1bmMgPSBfLmlzQXJyYXkocHJvbWlzZUZ1bmN0aW9uKTtcbiAgICAgIGlmIChpc0FycmF5RnVuYykge1xuICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgcHJvbWlzZUFsbCA9IHByb21pc2VGdW5jdGlvbi5tYXAoKGZ1bmMpID0+XG4gICAgICAgICAgdGhpcy5nZW5lcmF0ZVByb21pc2VGdW5jKGZ1bmMpXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9taXNlQWxsID0gW3RoaXMuZ2VuZXJhdGVQcm9taXNlRnVuYyhwcm9taXNlRnVuY3Rpb24gYXMgYW55KV07XG4gICAgICB9XG4gICAgICBjb25zdCB0YXNrID0gUHJvbWlzZS5hbGwocHJvbWlzZUFsbCk7XG4gICAgICBjb25zb2xlLmxvZyh0YXNrKTtcbiAgICAgIHRhc2tcbiAgICAgICAgLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgLy8gY2FsbCBzZXJ2ZXIgYW5kIHJlY2VpdmUgcmVzcG9uc2Ugd2l0aCBrbm93biBleGNlcHRpb25cbiAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAvLyBpZiAoXG4gICAgICAgICAgICAvLyAgIHJlc3VsdC5yZXF1ZXN0ICYmXG4gICAgICAgICAgICAvLyAgIHJlc3VsdC5kYXRhICYmXG4gICAgICAgICAgICAvLyAgIHJlc3VsdC5kYXRhLnJlc3BvbnNlRGF0YSAmJlxuICAgICAgICAgICAgLy8gICByZXN1bHQuZGF0YS5yZXNwb25zZURhdGEuZXJyb3JcbiAgICAgICAgICAgIC8vICkge1xuICAgICAgICAgICAgLy8gICB0aGlzLnNldEVycm9yKHJlc3VsdC5kYXRhLnJlc3BvbnNlRGF0YS5lcnJvcik7XG4gICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgLy8gY29uc3QgZXJyb3IgPSByZXN1bHQ/LmRhdGE/LmVycm9yPy5zdGF0dXM7XG5cbiAgICAgICAgICAgIC8vIGlmICghXy5pc0VtcHR5KGVycm9yKSkge1xuICAgICAgICAgICAgLy8gICB0aGlzLnNldEVycm9yKHJlc3VsdD8uZGF0YSk7XG4gICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIFN1Y2Nlc3NcbiAgICAgICAgICAgIHRoaXMuZGlzbWlzcygpO1xuICAgICAgICAgICAgaWYgKG9uU3VjY2Vzcykge1xuICAgICAgICAgICAgICBvblN1Y2Nlc3MoaXNBcnJheUZ1bmMgPyByZXN1bHQgOiByZXN1bHQ/LlswXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RXJyb3Ioe1xuICAgICAgICAgICAgICAvLyBtZXNzYWdlOiBNZXNzYWdlcy5ub3RSZXNwb25zZVNlcnZlcixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMudW5tb3VudGVkKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXRFcnJvcihlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0cnkoKSB7XG4gICAgdGhpcy5kb1Rhc2soKTtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmdWaWV3KCkge1xuICAgIHJldHVybiAoXG4gICAgICA8VmlldyBzdHlsZT17c3R5bGVzLmxvYWRpbmdDb250YWluZXJ9PlxuICAgICAgICA8VGV4dCBzdHlsZT17W3N0eWxlcy50ZXh0TG9hZGluZywgeyBjb2xvcjogXCJ3aGl0ZVwiIH1dfT5cbiAgICAgICAgICAja2VlcGNhbG1OZmlnaHRjb3JvbmFcbiAgICAgICAgPC9UZXh0PlxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJIb3Jpem9udGFsRGl2aWRlcigpIHtcbiAgICByZXR1cm4gPFZpZXcgc3R5bGU9e1tzdHlsZXMuZGl2aWRlciwgeyBoZWlnaHQ6IDEgfV19IC8+O1xuICB9XG5cbiAgcmVuZGVyVmVydGljYWxEaXZpZGVyKCkge1xuICAgIHJldHVybiA8VmlldyBzdHlsZT17W3N0eWxlcy5kaXZpZGVyLCB7IHdpZHRoOiAxIH1dfSAvPjtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGVycm9yIH0gPSB0aGlzLnN0YXRlO1xuICAgIHJldHVybiAoXG4gICAgICAvKiogRGltIGJhY2tncm91bmQgYW5kIGhhbmRsZSB0b3VjaCBvdXRzaWRlICovXG4gICAgICA8VmlldyBzdHlsZT17c3R5bGVzLmNvbnRhaW5lcn0+XG4gICAgICAgIHshZXJyb3IgJiYgdGhpcy5yZW5kZXJMb2FkaW5nVmlldygpfVxuICAgICAgICB7ZXJyb3IgJiYgKFxuICAgICAgICAgIDxWaWV3IHN0eWxlPXtzdHlsZXMuZGlhbG9nfT5cbiAgICAgICAgICAgIHsvKiA8VGV4dCBzdHlsZT17c3R5bGVzLnRpdGxlfT57TWVzc2FnZXMuZXJyb3J9PC9UZXh0PiAqL31cbiAgICAgICAgICAgIDxUZXh0IHN0eWxlPXtzdHlsZXMudGV4dENvbnRlbnR9PntlcnJvci5tZXNzYWdlfTwvVGV4dD5cblxuICAgICAgICAgICAge3RoaXMucmVuZGVySG9yaXpvbnRhbERpdmlkZXIoKX1cbiAgICAgICAgICAgIDxWaWV3XG4gICAgICAgICAgICAgIHN0eWxlPXt7IGZsZXhEaXJlY3Rpb246IFwicm93LXJldmVyc2VcIiwgYWxpZ25JdGVtczogXCJjZW50ZXJcIiB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8VG91Y2hhYmxlT3BhY2l0eVxuICAgICAgICAgICAgICAgIHN0eWxlPXtzdHlsZXMuYnV0dG9uU3R5bGV9XG4gICAgICAgICAgICAgICAgb25QcmVzcz17KCkgPT4gdGhpcy5yZXRyeSgpfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgey8qIDxUZXh0IHN0eWxlPXtzdHlsZXMuYnV0dG9uVGV4dH0+e01lc3NhZ2VzLnJldHJ5fTwvVGV4dD4gKi99XG4gICAgICAgICAgICAgIDwvVG91Y2hhYmxlT3BhY2l0eT5cbiAgICAgICAgICAgICAge3RoaXMucmVuZGVyVmVydGljYWxEaXZpZGVyKCl9XG4gICAgICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5XG4gICAgICAgICAgICAgICAgc3R5bGU9e3N0eWxlcy5idXR0b25TdHlsZX1cbiAgICAgICAgICAgICAgICBvblByZXNzPXsoKSA9PiB0aGlzLmNhbmNlbCgpfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgey8qIDxUZXh0IHN0eWxlPXtzdHlsZXMuYnV0dG9uVGV4dH0+e01lc3NhZ2VzLmNhbmNlbH08L1RleHQ+ICovfVxuICAgICAgICAgICAgICA8L1RvdWNoYWJsZU9wYWNpdHk+XG4gICAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICAgPC9WaWV3PlxuICAgICAgICApfVxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IFByb2dyZXNzO1xuIl19